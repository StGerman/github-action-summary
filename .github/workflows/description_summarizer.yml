# Documentation: https://docs.github.com/ru/actions
# Workflow for updating PR description with AI summary
name: AI Summary for Pull Request
run-name: ${{ github.actor }} updating summary ðŸ“”
on: [pull_request]
jobs:
  Update-PR-Description:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Install dependencies
        run: make install
      - name: Generate summary
        id: summary
        run: |
          make diff > diff.txt
          cat diff.txt
          make summary --always-make > summary.txt
          cat summary.txt
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      - name: Update PR Description
        uses: nefrob/pr-description@v1.1.2
        if: steps.summary.outcome == 'success'
        with:
          content: summary.txt
          regex: 'code:summary'
          contentIsFilePath: true
          regexFlags: s
          token: ${{ secrets.GITHUB_TOKEN }}
